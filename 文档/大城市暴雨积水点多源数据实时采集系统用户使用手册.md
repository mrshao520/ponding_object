# 大城市暴雨积水点多源数据实时采集处理系统用户使用手册

## 第一章 系统介绍

全球气候变化和快速城市化打破了城市降水—汇水—排水原有的平衡, 加剧了中国城市洪涝问题, 造成了巨大的生命和财产损失。因此, 亟须探索精确、高效的对洪涝灾害事件进行监测分析方法, 提高城市防洪抗灾能力, 降低灾害损失影响。

已经有相当多的研究对洪涝灾害事件进行监测分析，诸如分析受灾范围与受灾人口，集成遥感与深度学习的方法提取积水深度等。然而传统的传感器网络提供的数据时空分辨率不足，且卫星对地表观测容易受到云层的遮挡，致使访问周期变长。与此同时，城市洪涝渍水的特点是影响时间较短，这也对数据的时间分辨率（密度）产生较高的需求。

以多源数据为代表的社会感知方法是物理感知网络的一种重要补充，主要是指时空标记的大数据以及基于这种大数据的方法和应用，着重于对社会经济领域，在自然灾害的监测与预警中同样发挥着重要的作用，是一种快速、低成本、高效的监测方式。社会感知数据相较于传感网络有着数据海量，覆盖面积广，观测密度高且可以详细的记录人类行为模式的优点。然而社会感知方法获取的海量的观测数据有着严重的噪声问题。社会感知的数据来源多样，结构不一致且有效信息密度很低。以社交媒体数据为代表的社会感知数据，大量有价值的信息淹没在大量无关消息之中。对自然灾害的描述信息，多以文本描述形式存在。这些不规则的信息无疑为科学研究带来了一定的影响，凭借人工进行筛选费时费力且不具有时效性。

所以我们的系统利用网络爬虫等技术实现针对微博、抖音等渠道的大城市暴雨积水点多源数据实时获取，使用预训练的UIE模型对获取的数据进行处理，提取如积水点，时间，积水深度等有效信息，形成北京市等大城市近5年积水点数据集。



## 第二章 功能介绍

### 2.1 客户端模块功能介绍

#### 2.1.1 模块结构图

![image-20240115105712539](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E7%A7%AF%E6%B0%B4%E7%82%B9%E9%A1%B9%E7%9B%AE%E7%B3%BB%E7%BB%9F%E4%BB%8B%E7%BB%8D/image-20240115105712539.png)

![image-20240426110624254](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E6%9A%B4%E9%9B%A8%E7%A7%AF%E6%B0%B4%E7%82%B9%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/image-20240426110624254.png)

#### 2.1.2 显示模块

中心地图可视化显示区域，将显示通过爬虫收集整理得到的每个城市5年的历史积水点总数。其中，总数值最大的五个城市将以呼吸灯效果进行显示。同时，在获得积水深度值的前提下，若积水深度值超过一定的阈值，将采用红色呼吸灯的效果在中心地图可视化区域显示，进行警示。

![image-20240426103819549](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E6%9A%B4%E9%9B%A8%E7%A7%AF%E6%B0%B4%E7%82%B9%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/image-20240426103819549.png)

城市历年积水点柱状图显示区域，将显示每个城市最近5年的积水点个数，该区域有三种显示方式，分别为柱状图显示，折线图显示，以及总数柱状图显示，默认为柱状图显示。三种显示方式将以5秒的间隔轮询切换显示。同时提供停止自动切换和开始自动切换按钮，也可以手动切换显示方式，如下图所示。也可以直接查看数据视图，对大城市的近5年历史积水点数有更直观的了解。也可以将图表直接保存为图片。![image-20240426103850573](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E6%9A%B4%E9%9B%A8%E7%A7%AF%E6%B0%B4%E7%82%B9%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/image-20240426103850573.png)

![image-20240426130439402](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E6%9A%B4%E9%9B%A8%E7%A7%AF%E6%B0%B4%E7%82%B9%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/image-20240426130439402.png)

![image-20240426103905761](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E6%9A%B4%E9%9B%A8%E7%A7%AF%E6%B0%B4%E7%82%B9%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/image-20240426103905761.png)

![image-20240426103925988](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E6%9A%B4%E9%9B%A8%E7%A7%AF%E6%B0%B4%E7%82%B9%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/image-20240426103925988.png)

城市积水点汇总饼状图显示区域，将显示每个城市发生的历史积水点总数。该区域有两种显示方式，分别为基础饼状图和南丁格尔玫瑰图。如下图所示，提供与城市历年积水点柱状图显示区域相似功能。支持轮询切换显示、数据视图和保存为图片等功能。

<img src="assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E6%9A%B4%E9%9B%A8%E7%A7%AF%E6%B0%B4%E7%82%B9%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/image-20240426110759197.png" alt="image-20240426110759197" style="zoom:80%;" /><img src="assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E6%9A%B4%E9%9B%A8%E7%A7%AF%E6%B0%B4%E7%82%B9%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A/image-20240426110838671.png" alt="image-20240426110838671" style="zoom:80%;" />

#### 2.1.3 属性设置模块

属性设置模块中，共有城市选取模块，采集渠道设置模块和采集属性设置模块。城市选取模块中可以选取超大型城市和大型城市，并且可以通过配置文件增加或删除城市。采集渠道设置模块中可以选取搜狐、微博、腾讯和抖音等渠道。采集属性设置模块中，共有定时采集模块，实时数据采集模块和历史数据采集模块。实时数据采集模块默认当天的数据为实时数据，开始时间为当日凌晨，结束时间为当前时间。历史数据采集模块中，可以手动设置开始时间和结束时间。定时采集模块中，可以设置系统自动爬取平台数据的间隔时间，比如每30分钟采集一次。

![image-20240426103954982](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E6%9A%B4%E9%9B%A8%E7%A7%AF%E6%B0%B4%E7%82%B9%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/image-20240426103954982.png)

#### 2.1.4 功能模块

功能模块中，共有采集模块，模型处理模块和历史数据模块。采集模块中，选取想要采集的属性后，点击开始采集，即可进行采集。也可以点击停止采集提前终止采集。采集完成后，采集到的数据将会显示在系统的相应区域。点击开始处理，即可将采集到的数据上传至服务端，在服务端将调用所训练的信息处理模型进行关键字段的提取，如日期，城市，地点等信息。并将提取后的信息保存至数据库，在保存过程中将会对数据进行去重、清洗等操作。提取后的信息将传回客户端，客户端将在系统的右下角区域显示处理后的结果，点击保存即可更新显示模块，并将信息保存在本地。历史数据模块中，选取城市后，手动设置开始时间和结束时间，即可进行查询，查询后的结果将在系统中的相应区域显示。选中查询后的结果，点击删除即可删除该数据。

![image-20240115150106313](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E7%A7%AF%E6%B0%B4%E7%82%B9%E9%A1%B9%E7%9B%AE%E7%B3%BB%E7%BB%9F%E4%BB%8B%E7%BB%8D/image-20240115150106313.png)

![image-20240115150115130](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E7%A7%AF%E6%B0%B4%E7%82%B9%E9%A1%B9%E7%9B%AE%E7%B3%BB%E7%BB%9F%E4%BB%8B%E7%BB%8D/image-20240115150115130.png)

![image-20240115150133547](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E7%A7%AF%E6%B0%B4%E7%82%B9%E9%A1%B9%E7%9B%AE%E7%B3%BB%E7%BB%9F%E4%BB%8B%E7%BB%8D/image-20240115150133547.png)

#### 2.1.5 更新功能

修改配置文件之后，如修改城市名或者服务器地址，可以通过系统页面顶部右击鼠标，点击刷新。即可更新页面和配置。每一次刷新都会与服务端进行同步，保证本地的历史数据是最新的。

![image-20240426111133915](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E6%9A%B4%E9%9B%A8%E7%A7%AF%E6%B0%B4%E7%82%B9%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/image-20240426111133915.png)

### 2.2 服务端功能介绍

#### 2.2.1 UIE模型

UIE(Universal Information Extraction)：框架实现了实体抽取、关系抽取、事件抽取、情感分析等任务的统一建模，并使得不同任务间具备良好的迁移和泛化能力。该模型可以支持不限定行业领域和抽取目标的关键信息抽取，实现零样本快速冷启动，并具备优秀的小样本微调能力，快速适配特定的抽取目标。

#### 2.2.2 UIE模型部署

服务端使用Flask Web框架以及FastDeploy AI推理部署工具进行快速化部署UIE模型，并使用Docker容器快速部署环境。使用Flask提供API接口，使用FastDeploy进行模型推理，并使用MySQL进行数据持久化。



## 第三章 结构介绍

### 3.1 客户端结构介绍

```
project # 项目主目录
|
├── README.md                       # 系统介绍
├── pongind.exe						# 程序
├── requirements.txt				# 系统环境文件
│
└───documents						# 配置文件夹
│   ├── city_volume.json			# 15个城市历史数据文件
│   ├── config.json					# 配置文件
│   └── weibo.json					# 微博账号信息文件
│   
└───log								# 系统日志文件夹
|   └── waterlogging.log			# 系统日志
│   
└───resources						# 资源文件夹
	├── font						# 系统字体文件夹
	|   └─── DS-DIGIT.ttf			# 字体
	|
	├── html						# echarts图表html文件夹
	|   ├── echarts					# echarts文件
	|	├── city_volume_pie.html	# 城市积水点汇总饼状图显示
	|	├── city_year_bar.html		# 城市历年积水点柱状图显示
	|	└── map.html				# 中心地图可视化显示
	|
	├── images						# 图片资源文件夹
    └── chromedriver.exe			# 谷歌浏览器内核文件

```

### 3.2 服务端结构介绍

```
water_server # 项目主目录
|
├── README.md                       # 系统介绍
├── requirements.txt				# 系统环境文件
├── apply.p                       	# 服务端程序入口
├── UIE_Model.py                    # UIE模型
│   
└───FatDeployDocker					# Docker文件夹
|   └── Dockerfile					# Dockerfile
│   
└───log								# 系统日志文件夹
|   └── waterlogging.log			# 系统日志
│   
└─── model_best						# UIE模型文件夹
	├── inference.pdiparams			# 用于存储网络权重信息
	├── inference.pdiparams.info	# 用于存储模型的参数信息
	└── inference.pdmodel			# 用于存储网络结构信息

```



## 第四章 系统总体功能

### 4.1 功能流程图

![泳道图](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E7%A7%AF%E6%B0%B4%E7%82%B9%E9%A1%B9%E7%9B%AE%E7%B3%BB%E7%BB%9F%E4%BB%8B%E7%BB%8D/%E6%B3%B3%E9%81%93%E5%9B%BE-17060809399601.png)



### 4.2 总体功能

本系统采用C/S架构，在属性设置模块中选取想要检索的属性，如城市选取大型城市重庆，采集渠道设置选取腾讯，选取历史数据采集，开始时间为2023-01-15，结束时间为2024-01-15。点击开始采集，即可进行采集。也可以点击停止采集提前终止采集。通过selenium模块模拟用户去访问各平台获取该系统所需的数据对应的url，因为selenium不能实现异步请求所以将所有的url传给scrapy作为起始url。在scrapy中对url进行访问，在下载中间键（DownloaderMiddleware）里更改自己的配置，如添加cookie信息绕过平台的反爬虫。 对scrapy获取的数据进行筛选，如该条数据里包含的时间是否在我所需的范围内以及数据里的文本是否有我所需的信息。最后通过管道(pipelines)对数据进行传输。

 采集完成后，采集到的数据将会显示在系统的相应区域，如下图所示。点击开始处理，即可将采集到的数据上传至服务端，在服务端将调用所训练的信息处理模型进行关键字段的提取，如日期，城市，地点等信息。并将提取后的信息保存至数据库，在保存过程中将会对数据进行去重、清洗等操作。提取后的信息将传回客户端，客户端将在系统的右下角区域显示处理后的结果，点击保存即可更新显示模块，并将信息保存在本地。在获得积水深度值的前提下，如果积水深度值超过一定阈值，将在中心地图显示区域中以红色呼吸灯效果显示。历史数据模块中，选取城市后，手动设置开始时间和结束时间，即可进行查询，查询后的结果将在系统中的相应区域显示。选中查询后的结果，点击删除即可删除该数据。

![image-20240115151357011](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E7%A7%AF%E6%B0%B4%E7%82%B9%E9%A1%B9%E7%9B%AE%E7%B3%BB%E7%BB%9F%E4%BB%8B%E7%BB%8D/image-20240115151357011.png)



### 4.3 爬虫注意事项

1. 对于微博平台需要定期更新身份信息，需要客户在移动端上登录我所提供的微博账号或者提供一个账号

   ```
   账号：13085559937   密码：zxcv123
   ```

2. 在系统中如何更新微博身份信息
   1. 在系统页面顶部右击鼠标，会出现图中所示
   2. 点击登录微博后请稍等片刻在移动端中确认登录，如果移动端没有反应 请稍等片刻后尝试重新登录

![1](assets/%E5%A4%A7%E5%9F%8E%E5%B8%82%E7%A7%AF%E6%B0%B4%E7%82%B9%E9%A1%B9%E7%9B%AE%E7%B3%BB%E7%BB%9F%E4%BB%8B%E7%BB%8D/1.png)

3. 有些平台需要识别验证码所以爬虫代码里用到了超级鹰验证码识别平台，该平台要收费请定期充值避免系统无法使用，超级鹰官网：https://www.chaojiying.com/user/login/

   ```
   对应的账号密码： 账号：caoguimeng   密码：cgm200066
   ```

4. 在使用系统时请勿短时间内获取太多次，避免对网站造成不必要的负担导致IP封禁
